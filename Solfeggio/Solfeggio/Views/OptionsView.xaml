<ContentView
	x:Class="Solfeggio.Views.OptionsView"
	xmlns="http://xamarin.com/schemas/2014/forms"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:m="clr-namespace:Ace.Markup;assembly=Ace"
	xmlns:presenters="clr-namespace:Solfeggio.Presenters"
	xmlns:viewModels="clr-namespace:Solfeggio.ViewModels"
	xmlns:controls="clr-namespace:Solfeggio.Controls"
	xmlns:converters="clr-namespace:Solfeggio.Converters">

	<ContentView.Resources>
		<converters:DelegateToNameConverter
			x:Key="DelegateToNameConverter" />
		<converters:PowConverter x:Key="PowConverter" />

		<m:Set x:Key="VisualizationOptionsSet">
			<Picker
				Tag="{m:Localizing Key=PitchStandard}"
				ItemsSource="{Binding PitchStandards}"
				SelectedItem="{Binding ActivePitchStandard, Mode=TwoWay}" />

			<Entry
				Tag="{m:Localizing Key=LowFrequency}"
				Text="{Binding LowFrequency, Mode=TwoWay}" />

			<Entry
				Tag="{m:Localizing Key=TopFrequency}"
				Text="{Binding TopFrequency, Mode=TwoWay}" />

			<Picker
				Tag="{m:Localizing Key=MagnitudeScaleFunc}"
				ItemsSource="{Binding FrequancyScaleFuncs}"
				SelectedItem="{Binding MagnitudeScaleFunc, Mode=TwoWay}"
				ItemDisplayBinding="{Binding Converter={StaticResource DelegateToNameConverter}}" />

			<Picker
				Tag="{m:Localizing Key=FrequancyScaleFunc}"
				ItemsSource="{Binding FrequancyScaleFuncs}"
				SelectedItem="{Binding FrequancyScaleFunc, Mode=TwoWay}"
				ItemDisplayBinding="{Binding Converter={StaticResource DelegateToNameConverter}}" />

			<Switch
				Tag="{m:Localizing Key=PeakHz}"
				IsToggled="{Binding Show.PeakHz, Mode=TwoWay}" />

			<Switch
				Tag="{m:Localizing Key=Notes}"
				IsToggled="{Binding Show.Notes, Mode=TwoWay}" />

			<Switch
				Tag="{m:Localizing Key=Spectrum}"
				IsToggled="{Binding Show.Spectrum, Mode=TwoWay}" />

			<Switch
				Tag="{m:Localizing Key=Wave}"
				IsToggled="{Binding Show.Wave, Mode=TwoWay}" />

			<Switch
				Tag="{m:Localizing Key=NotesGrid}"
				IsToggled="{Binding Show.NotesGrid, Mode=TwoWay}" />

			<Switch
				Tag="{m:Localizing Key=DiscreteFourierGrid}"
				IsToggled="{Binding Show.DiscreteFourierGrid, Mode=TwoWay}" />

			<ItemsView>
				<Entry
					Text="{m:StoreBinding Path=ActiveDevice.Frequancy, Mode=TwoWay, StoreKey=viewModels:SpectralViewModel}" />
				<Slider
					Minimum="{m:StoreBinding Path=LowFrequency, StoreKey=presenters:MusicalPresenter}"
					Maximum="{m:StoreBinding Path=TopFrequency, StoreKey=presenters:MusicalPresenter}"
					Value="{m:StoreBinding Path=ActiveDevice.Frequancy, Mode=TwoWay, StoreKey=viewModels:SpectralViewModel}" />
			</ItemsView>
		</m:Set>
		
		<m:Set x:Key="AdvancedOptionsSet">
			<Picker
				Tag="{m:Localizing Key=Device}"
				ItemsSource="{Binding Devices}"
				SelectedItem="{Binding ActiveDevice, Mode=TwoWay}" />

			<Picker
				Tag="{m:Localizing Key=SampleRate}"
				ItemsSource="{Binding ActiveDevice.SampleRates}"
				SelectedItem="{Binding SampleRate, Mode=TwoWay}" />

			<Picker
				Tag="{m:Localizing Key=Window}"
				ItemsSource="{Binding Windows}"
				SelectedItem="{Binding ActiveWindow, Mode=TwoWay}"
				ItemDisplayBinding="{Binding Converter={StaticResource DelegateToNameConverter}}" />

			<Picker
				Tag="{m:Localizing Key=PowOf2}"
				ItemsSource="{StaticResource AllowedPowsOf2}"
				SelectedItem="{Binding FramePow, Mode=TwoWay}" />

			<Picker
				Tag="{m:Localizing Key=ShiftSize}"
				ItemsSource="{StaticResource AllowedPowsOf2}"
				SelectedItem="{Binding FramePow, Mode=TwoWay}" />

			<Entry
				Tag="{m:Localizing Key=ShiftsPerFrame}"
				Text="{Binding ShiftsPerFrame, Mode=TwoWay}" />

			<Switch
				Tag="{m:Localizing Key=UseAliasing}"
				IsToggled="{Binding UseAliasing, Mode=TwoWay}" />
		</m:Set>
	</ContentView.Resources>

	<controls:Pivot>

		<controls:PivotItem
			Header="{m:Localizing Key=Сalibration}">
			
			<Grid
				m:Rack.Rows="^ ^ ^ ^ ^ ^"
				m:Rack.Columns="^ * ^"
				BindingContext="{m:Store Key=presenters:MusicalPresenter}">

				<Label
					m:Rack.Cell="R0 C0"
					Text="{m:Localizing Key=Sensitive}" />

				<Label
					m:Rack.Cell="R1 C0"
					Text="{m:Localizing Key=Whisper}" />
				<Slider
					m:Rack.Cell="R1 C1"
					Maximum="1"
					Minimum="0"
					Value="{Binding TopMagnitude, Mode=TwoWay}" />
				<Label
					m:Rack.Cell="R1 C2"
					Text="{m:Localizing Key=Cry}" />

				<StackLayout
					m:Rack.Cell="R0 C1"
					Orientation="Horizontal">
					<Label
						Text="{m:Localizing Key=Manual}" />
					<Switch
						IsToggled="{Binding AutoSensitive, Mode=TwoWay}" />
					<Label
						Text="{m:Localizing Key=Automatic}" />
				</StackLayout>

				<Label
					m:Rack.Cell="R3 C0 CS3"
					Text="{m:Localizing Key=TimeFrame}" />

				<StackLayout
					m:Rack.Cell="R4 C0">
					<Label
						Text="{m:Localizing Key=Short-Speed}" />
				</StackLayout>
				<Slider
					m:Rack.Cell="R4 C1"
					Maximum="13"
					Minimum="9"				
					Value="{m:StoreBinding Path=FramePow, Mode=TwoWay, StoreKey=viewModels:SpectralViewModel}" />
				<StackLayout
					m:Rack.Cell="R4 C2">
					<Label
						Text="{m:Localizing Key=Long-Accurate}" />
				</StackLayout>

				<Grid
					m:Rack.Cell="R5 C1 CS1"
					m:Rack.Rows="^ ^ ^ ^"
					m:Rack.Columns="^ ^ ^ ^ ^"
					BindingContext="{m:Store Key=viewModels:SpectralViewModel}">

					<Label
						m:Rack.Cell="R0 C0"
						Text="{m:Localizing Key=Duration}" />

					<Label
						m:Rack.Cell="R1 C0"
						Text="{m:Localizing Key=Sample}" />
					<Label
						m:Rack.Cell="R2 C0"
						Text="{m:Localizing Key=Frame}" />
					<Label
						m:Rack.Cell="R0 C2"
						Text="bins" />
					<Label
						m:Rack.Cell="R0 C1"
						Text="ms" />

					<Label
						m:Rack.Cell="R1 C2"
						Text="{Binding ActiveDevice.SampleSize}" />
					<Label
						m:Rack.Cell="R2 C2"
						Text="{Binding FrameSize}" />
					<Label
						m:Rack.Cell="R1 C1"
						Text="{Binding ActiveDevice.SampleDuration.TotalMilliseconds}" />
					<Label
						m:Rack.Cell="R2 C1"
						Text="{Binding FrameDuration.TotalMilliseconds}" />
				</Grid>

			</Grid>
			
		</controls:PivotItem>

		<controls:PivotItem
			Header="{m:Localizing Key=Visualization}">
			
			<ItemsView
				ItemTemplate="{StaticResource OptionTemplate}"
				ItemsSource="{StaticResource VisualizationOptionsSet}"
				BindingContext="{m:Store Key=presenters:MusicalPresenter}" />

		</controls:PivotItem>

		<controls:PivotItem
			Header="{m:Localizing Key=Advanced}">

			<ItemsView
				ItemTemplate="{StaticResource OptionTemplate}"
				ItemsSource="{StaticResource AdvancedOptionsSet}"
				BindingContext="{m:Store Key=viewModels:SpectralViewModel}" />

		</controls:PivotItem>

		<controls:PivotItem
			Header="{m:Localizing Key=Generator}">

			<ItemsView>
				<Entry
					Text="{m:StoreBinding Path=ActiveDevice.Frequancy, Mode=TwoWay, StoreKey=viewModels:SpectralViewModel}" />
				<Slider
					Minimum="{m:StoreBinding Path=LowFrequency, StoreKey=presenters:MusicalPresenter}"
					Maximum="{m:StoreBinding Path=TopFrequency, StoreKey=presenters:MusicalPresenter}"
					Value="{m:StoreBinding Path=ActiveDevice.Frequancy, Mode=TwoWay, StoreKey=viewModels:SpectralViewModel}" />
			</ItemsView>

		</controls:PivotItem>

	</controls:Pivot>

</ContentView>